# Fluxos Principais - Sistema de GestÃ£o de Projetos de Engenharia

## Ãndice
1. [AutenticaÃ§Ã£o e AutorizaÃ§Ã£o](#1-autenticaÃ§Ã£o-e-autorizaÃ§Ã£o)
2. [GestÃ£o de Projetos](#2-gestÃ£o-de-projetos)
3. [GestÃ£o de Etapas](#3-gestÃ£o-de-etapas)
4. [GestÃ£o de Tarefas](#4-gestÃ£o-de-tarefas)
5. [Kanban - MovimentaÃ§Ã£o de Status](#5-kanban---movimentaÃ§Ã£o-de-status)
6. [AlocaÃ§Ã£o de Horas](#6-alocaÃ§Ã£o-de-horas)
7. [AtribuiÃ§Ã£o de UsuÃ¡rios](#7-atribuiÃ§Ã£o-de-usuÃ¡rios)
8. [Dashboard e Monitoramento](#8-dashboard-e-monitoramento)

---

## 1. AutenticaÃ§Ã£o e AutorizaÃ§Ã£o

### 1.1 Fluxo de Login

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UsuÃ¡rio â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Acessa /login
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tela de Login â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 2. Insere email + senha
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auth/loginâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 3. Validar credenciais
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Databaseâ”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
         â”‚
         â”‚ 4. Comparar hash da senha
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Gerar JWT Token  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 5. Retornar token + user data
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Armazenar no localStorageâ”‚
â”‚ - accessToken           â”‚
â”‚ - refreshToken          â”‚
â”‚ - userData              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 6. Redirecionar para dashboard
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Dashboard â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ValidaÃ§Ãµes**:
- âœ… Email existe no banco
- âœ… Senha hash corresponde
- âœ… UsuÃ¡rio estÃ¡ ativo (is_active = TRUE)
- âŒ Bloquear apÃ³s 5 tentativas falhas

**Resposta de Sucesso**:
```json
{
  "success": true,
  "data": {
    "accessToken": "eyJhbGc...",
    "refreshToken": "eyJhbGc...",
    "user": {
      "id": 1,
      "email": "user@example.com",
      "full_name": "JoÃ£o Silva",
      "role": "supervisor"
    }
  }
}
```

### 1.2 Fluxo de Refresh Token

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Token expirando     â”‚
â”‚ (24h de vida)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 1. Detectar token expirado (401)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auth/refresh   â”‚
â”‚ Body: { refreshToken }   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 2. Validar refresh token
           â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚Databaseâ”‚
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
           â”‚
           â”‚ 3. Gerar novo accessToken
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retornar novo accessToken  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 4. Atualizar localStorage
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Continuar uso â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. GestÃ£o de Projetos

### 2.1 Fluxo de CriaÃ§Ã£o de Projeto

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supervisor â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Clica em "Novo Projeto"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Modal de CriaÃ§Ã£o  â”‚
â”‚ - Nome            â”‚
â”‚ - DescriÃ§Ã£o       â”‚
â”‚ - Data InÃ­cio     â”‚
â”‚ - Data Final      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Preenche formulÃ¡rio
       â”‚ 3. Clica em "Criar"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/projects      â”‚
â”‚ Body: {                 â”‚
â”‚   name,                 â”‚
â”‚   description,          â”‚
â”‚   start_date,           â”‚
â”‚   due_date,             â”‚
â”‚   supervisor_id         â”‚
â”‚ }                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. ValidaÃ§Ãµes Backend
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Nome obrigatÃ³rio      â”‚
â”‚ âœ… due_date > start_date â”‚
â”‚ âœ… User Ã© Supervisor/Adminâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. Inserir no banco
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INSERT INTO projects    â”‚
â”‚ status = 'active'       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. Retornar projeto criado
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Atualizar lista frontendâ”‚
â”‚ Exibir mensagem sucesso â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ValidaÃ§Ãµes**:
- âœ… UsuÃ¡rio tem permissÃ£o (Supervisor/Admin)
- âœ… Nome nÃ£o vazio
- âœ… due_date maior que start_date
- âœ… due_date nÃ£o pode ser no passado

### 2.2 Fluxo de CÃ¡lculo de Risco de Projeto

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Evento disparador:  â”‚
â”‚ - Tarefa criada     â”‚
â”‚ - Tarefa editada    â”‚
â”‚ - Etapa alterada    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 1. Chamar cÃ¡lculo
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CALL sp_calculate_project_deadlineâ”‚
â”‚ (project_id)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 2. Calcular tempo estimado
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Para cada etapa:               â”‚
â”‚   Se is_parallel = FALSE:      â”‚
â”‚     tempo = SOMA(tarefas)      â”‚
â”‚   Se is_parallel = TRUE:       â”‚
â”‚     tempo = MAX(tarefas)       â”‚
â”‚                                â”‚
â”‚ tempo_total = SOMA(etapas)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 3. Comparar com due_date
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Se tempo_total > due_date:     â”‚
â”‚   risk_status = 'AT_RISK'      â”‚
â”‚ Se faltam <= 7 dias:           â”‚
â”‚   risk_status = 'WARNING'      â”‚
â”‚ Caso contrÃ¡rio:                â”‚
â”‚   risk_status = 'ON_TRACK'     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 4. Retornar resultado
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend exibe badge de risco: â”‚
â”‚ ğŸ”´ AT_RISK (vermelho)          â”‚
â”‚ ğŸŸ¡ WARNING (amarelo)           â”‚
â”‚ ğŸŸ¢ ON_TRACK (verde)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. GestÃ£o de Etapas

### 3.1 Fluxo de CriaÃ§Ã£o de Etapa

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supervisor â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Abre projeto
       â”‚ 2. Clica em "Nova Etapa"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Modal de CriaÃ§Ã£o    â”‚
â”‚ - Nome              â”‚
â”‚ - DescriÃ§Ã£o         â”‚
â”‚ - is_parallel?      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. Preenche e salva
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/projects/:id/stagesâ”‚
â”‚ Body: {                      â”‚
â”‚   name,                      â”‚
â”‚   description,               â”‚
â”‚   is_parallel                â”‚
â”‚ }                            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. Calcular 'order'
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT MAX(order) + 1        â”‚
â”‚ FROM project_stages          â”‚
â”‚ WHERE project_id = X         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. Inserir no banco
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INSERT INTO project_stages   â”‚
â”‚ order = max_order + 1        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. Recalcular prazo projeto
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CALL sp_calculate_deadline   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. Retornar etapa criada
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Atualizar lista frontend     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. GestÃ£o de Tarefas

### 4.1 Fluxo de CriaÃ§Ã£o de Tarefa

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supervisor â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Abre etapa
       â”‚ 2. Clica em "Nova Tarefa"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Modal de CriaÃ§Ã£o            â”‚
â”‚ - TÃ­tulo                    â”‚
â”‚ - DescriÃ§Ã£o                 â”‚
â”‚ - Horas Estimadas           â”‚
â”‚ - Horas DiÃ¡rias             â”‚
â”‚ - Prioridade                â”‚
â”‚ - UsuÃ¡rios AtribuÃ­dos       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. Preenche formulÃ¡rio
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/stages/:id/tasks  â”‚
â”‚ Body: {                     â”‚
â”‚   title,                    â”‚
â”‚   description,              â”‚
â”‚   estimated_hours,          â”‚
â”‚   daily_hours,              â”‚
â”‚   priority,                 â”‚
â”‚   assigned_users: [1, 3, 5] â”‚
â”‚ }                           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. ValidaÃ§Ãµes Backend
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… TÃ­tulo obrigatÃ³rio            â”‚
â”‚ âœ… estimated_hours > 0           â”‚
â”‚ âœ… daily_hours <= 8              â”‚
â”‚ âœ… daily_hours <= estimated_hoursâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. Para cada usuÃ¡rio atribuÃ­do
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validar limite 8h/dia            â”‚
â”‚ CALL fn_validate_daily_hours     â”‚
â”‚ (user_id, daily_hours)           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. Se OK, inserir tarefa
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BEGIN TRANSACTION                â”‚
â”‚                                  â”‚
â”‚ INSERT INTO tasks                â”‚
â”‚ status = 'novo'                  â”‚
â”‚                                  â”‚
â”‚ INSERT INTO task_assignments     â”‚
â”‚ (para cada usuÃ¡rio)              â”‚
â”‚                                  â”‚
â”‚ COMMIT                           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. Recalcular prazo
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CALL sp_calculate_deadline       â”‚
â”‚ (project_id)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 8. Retornar tarefa criada
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Atualizar lista frontend         â”‚
â”‚ Enviar notificaÃ§Ã£o aos usuÃ¡rios  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Caso de Erro - Limite Excedido**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ fn_validate_daily_hours          â”‚
â”‚ retorna FALSE                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ ROLLBACK TRANSACTION
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retornar erro HTTP 400           â”‚
â”‚ {                                â”‚
â”‚   "error": "Limite excedido",    â”‚
â”‚   "message": "UsuÃ¡rio JoÃ£o jÃ¡    â”‚
â”‚     possui 6h alocadas.          â”‚
â”‚     DisponÃ­vel: 2h",             â”‚
â”‚   "user_id": 5,                  â”‚
â”‚   "current_hours": 6,            â”‚
â”‚   "available_hours": 2           â”‚
â”‚ }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Exibir mensagem no frontend
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ "âš ï¸ NÃ£o foi possÃ­vel atribuir    â”‚
â”‚  tarefa: JoÃ£o jÃ¡ possui 6h       â”‚
â”‚  alocadas (mÃ¡x 8h/dia)"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Kanban - MovimentaÃ§Ã£o de Status

### 5.1 Fluxo de MudanÃ§a de Status (User)

```
â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜
    â”‚
    â”‚ 1. Arrasta tarefa no Kanban
    â”‚    De: "novo" â†’ Para: "em_desenvolvimento"
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PATCH /api/tasks/:id/statusâ”‚
â”‚ Body: {                    â”‚
â”‚   status: "em_desenvolvimento"â”‚
â”‚ }                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 2. Verificar permissÃ£o
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validar matriz de transiÃ§Ã£o:  â”‚
â”‚                                â”‚
â”‚ novo â†’ em_desenvolvimento: âœ…  â”‚
â”‚ User pode fazer essa transiÃ§Ã£oâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 3. Se permitido, atualizar
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UPDATE tasks                   â”‚
â”‚ SET status = 'em_desenvolvimento'â”‚
â”‚ WHERE id = X                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 4. Retornar sucesso
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend move card visualmenteâ”‚
â”‚ Exibe toast: "Tarefa iniciada!"â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Fluxo de MudanÃ§a de Status (Supervisor - Refazer)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supervisor â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Revisar tarefa em "analise_tecnica"
       â”‚ 2. Encontra problemas
       â”‚ 3. Move para "refaca"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PATCH /api/tasks/:id/statusâ”‚
â”‚ Body: {                    â”‚
â”‚   status: "refaca",        â”‚
â”‚   reason: "Req. nÃ£o atende"â”‚
â”‚ }                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 4. Verificar permissÃ£o
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validar:                         â”‚
â”‚ - User role = supervisor/admin âœ…â”‚
â”‚ - TransiÃ§Ã£o vÃ¡lida:              â”‚
â”‚   analise_tecnica â†’ refaca âœ…    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 5. Atualizar tarefa
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BEGIN TRANSACTION                â”‚
â”‚                                  â”‚
â”‚ UPDATE tasks                     â”‚
â”‚ SET status = 'refaca'            â”‚
â”‚ WHERE id = X                     â”‚
â”‚                                  â”‚
â”‚ INSERT INTO task_history         â”‚
â”‚ (action, reason, user_id)        â”‚
â”‚                                  â”‚
â”‚ COMMIT                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 6. Disparar notificaÃ§Ãµes
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Notificar usuÃ¡rios atribuÃ­dos:  â”‚
â”‚ "ğŸ”´ Tarefa X precisa ser refeita"â”‚
â”‚ RazÃ£o: "Req. nÃ£o atende"         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 7. Atualizar dashboard
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Incrementar contador "refaca"    â”‚
â”‚ Adicionar Ã  lista prioritÃ¡ria    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Matriz de ValidaÃ§Ã£o**:
```typescript
const podeAlterarStatus = (
  userRole: 'user' | 'supervisor' | 'admin',
  fromStatus: TaskStatus,
  toStatus: TaskStatus
): boolean => {
  const transitions = {
    novo: {
      em_desenvolvimento: ['user', 'supervisor', 'admin'],
    },
    em_desenvolvimento: {
      novo: ['user', 'supervisor', 'admin'],
      analise_tecnica: ['supervisor', 'admin'],
    },
    analise_tecnica: {
      concluido: ['supervisor', 'admin'],
      refaca: ['supervisor', 'admin'],
    },
    refaca: {
      em_desenvolvimento: ['user', 'supervisor', 'admin'],
    },
    concluido: {} // Status final
  };

  return transitions[fromStatus]?.[toStatus]?.includes(userRole) || false;
};
```

---

## 6. AlocaÃ§Ã£o de Horas

### 6.1 Fluxo de EdiÃ§Ã£o de Horas DiÃ¡rias

```
â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜
    â”‚
    â”‚ 1. Abre tarefa atribuÃ­da
    â”‚ 2. Altera campo "Horas por dia"
    â”‚    De: 2h â†’ Para: 4h
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PUT /api/tasks/:id     â”‚
â”‚ Body: {                â”‚
â”‚   daily_hours: 4       â”‚
â”‚ }                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 3. Calcular total atual
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT SUM(daily_hours)          â”‚
â”‚ FROM tasks t                     â”‚
â”‚ JOIN task_assignments ta         â”‚
â”‚   ON t.id = ta.task_id           â”‚
â”‚ WHERE ta.user_id = X             â”‚
â”‚   AND t.id != current_task_id    â”‚
â”‚   AND t.status NOT IN            â”‚
â”‚     ('concluido', 'cancelado')   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Resultado: 5h alocadas
        â”‚
        â”‚ 4. Validar novo total
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ total_atual + novas_horas <= 8?  â”‚
â”‚ 5h + 4h = 9h âŒ EXCEDE           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 5. Bloquear operaÃ§Ã£o
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTP 400 Bad Request             â”‚
â”‚ {                                â”‚
â”‚   "error": "DAILY_LIMIT_EXCEEDED"â”‚
â”‚   "message": "VocÃª jÃ¡ possui 5h  â”‚
â”‚     alocadas. DisponÃ­vel: 3h",   â”‚
â”‚   "current_hours": 5,            â”‚
â”‚   "requested_hours": 4,          â”‚
â”‚   "available_hours": 3,          â”‚
â”‚   "task_breakdown": [            â”‚
â”‚     { "task": "X", "hours": 2 }, â”‚
â”‚     { "task": "Y", "hours": 3 }  â”‚
â”‚   ]                              â”‚
â”‚ }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 6. Exibir erro no frontend
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Modal de erro:                   â”‚
â”‚ "âš ï¸ Limite diÃ¡rio excedido"      â”‚
â”‚                                  â”‚
â”‚ VocÃª jÃ¡ possui:                  â”‚
â”‚ - Tarefa X: 2h                   â”‚
â”‚ - Tarefa Y: 3h                   â”‚
â”‚ Total: 5h                        â”‚
â”‚                                  â”‚
â”‚ DisponÃ­vel: 3h                   â”‚
â”‚                                  â”‚
â”‚ [Ajustar horas]  [Cancelar]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Fluxo de Registro de Tempo Trabalhado

```
â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜
    â”‚
    â”‚ 1. Abre tarefa
    â”‚ 2. Clica em "Registrar Tempo"
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Modal:                  â”‚
â”‚ - Data: 2026-01-02      â”‚
â”‚ - Horas: 3.5            â”‚
â”‚ - Notas: "Implementado  â”‚
â”‚          validaÃ§Ã£o X"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 3. Salvar registro
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/time-entries     â”‚
â”‚ Body: {                    â”‚
â”‚   task_id: 10,             â”‚
â”‚   user_id: 5,              â”‚
â”‚   date: "2026-01-02",      â”‚
â”‚   hours: 3.5,              â”‚
â”‚   notes: "Implementado..." â”‚
â”‚ }                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 4. ValidaÃ§Ãµes
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… User atribuÃ­do Ã  tarefa       â”‚
â”‚ âœ… Horas > 0 e <= 24             â”‚
â”‚ âœ… Data nÃ£o Ã© futura             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 5. Inserir no banco
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INSERT INTO time_entries         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 6. Calcular progresso
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT                           â”‚
â”‚   SUM(hours) as logged,          â”‚
â”‚   estimated_hours                â”‚
â”‚ FROM time_entries                â”‚
â”‚ WHERE task_id = X                â”‚
â”‚                                  â”‚
â”‚ progress = (logged / estimated)  â”‚
â”‚          = (3.5 / 20) * 100      â”‚
â”‚          = 17.5%                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 7. Atualizar UI
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Exibir barra de progresso:       â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 17.5%       â”‚
â”‚                                  â”‚
â”‚ Estimado: 20h                    â”‚
â”‚ Trabalhado: 3.5h                 â”‚
â”‚ Restante: ~16.5h                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. AtribuiÃ§Ã£o de UsuÃ¡rios

### 7.1 Fluxo de Atribuir UsuÃ¡rio a Tarefa

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supervisor â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Edita tarefa
       â”‚ 2. Seleciona usuÃ¡rios
       â”‚    [Pedro, Ana, Carlos]
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/tasks/:id/assignments  â”‚
â”‚ Body: {                          â”‚
â”‚   user_ids: [4, 5, 6]            â”‚
â”‚ }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 3. Para cada usuÃ¡rio
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validar limite 8h/dia            â”‚
â”‚                                  â”‚
â”‚ Para user_id = 4 (Pedro):        â”‚
â”‚   Horas atuais = 6h              â”‚
â”‚   Horas da tarefa = 3h           â”‚
â”‚   Total = 9h âŒ                  â”‚
â”‚                                  â”‚
â”‚ Para user_id = 5 (Ana):          â”‚
â”‚   Horas atuais = 4h              â”‚
â”‚   Horas da tarefa = 3h           â”‚
â”‚   Total = 7h âœ…                  â”‚
â”‚                                  â”‚
â”‚ Para user_id = 6 (Carlos):       â”‚
â”‚   Horas atuais = 2h              â”‚
â”‚   Horas da tarefa = 3h           â”‚
â”‚   Total = 5h âœ…                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 4. Retornar validaÃ§Ã£o
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTP 400 Bad Request             â”‚
â”‚ {                                â”‚
â”‚   "error": "VALIDATION_FAILED",  â”‚
â”‚   "results": [                   â”‚
â”‚     {                            â”‚
â”‚       "user_id": 4,              â”‚
â”‚       "user_name": "Pedro",      â”‚
â”‚       "success": false,          â”‚
â”‚       "reason": "Limite excedido",â”‚
â”‚       "current_hours": 6,        â”‚
â”‚       "available_hours": 2       â”‚
â”‚     },                           â”‚
â”‚     {                            â”‚
â”‚       "user_id": 5,              â”‚
â”‚       "user_name": "Ana",        â”‚
â”‚       "success": true            â”‚
â”‚     },                           â”‚
â”‚     {                            â”‚
â”‚       "user_id": 6,              â”‚
â”‚       "user_name": "Carlos",     â”‚
â”‚       "success": true            â”‚
â”‚     }                            â”‚
â”‚   ]                              â”‚
â”‚ }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 5. Exibir no frontend
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Modal:                           â”‚
â”‚ "âš ï¸ Alguns usuÃ¡rios nÃ£o puderam  â”‚
â”‚  ser atribuÃ­dos:"                â”‚
â”‚                                  â”‚
â”‚ âŒ Pedro Oliveira                â”‚
â”‚    JÃ¡ possui 6h alocadas         â”‚
â”‚    DisponÃ­vel: 2h                â”‚
â”‚                                  â”‚
â”‚ âœ… Ana Costa - AtribuÃ­da         â”‚
â”‚ âœ… Carlos Pereira - AtribuÃ­do    â”‚
â”‚                                  â”‚
â”‚ [Continuar]  [Cancelar]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Dashboard e Monitoramento

### 8.1 Fluxo de Carregamento do Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supervisor â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Acessa /dashboard
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/dashboard/statsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 2. Executar queries agregadas
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Query 1: Projetos em andamento    â”‚
â”‚ SELECT COUNT(*) FROM projects     â”‚
â”‚ WHERE status = 'active'           â”‚
â”‚   AND supervisor_id = :user_id    â”‚
â”‚                                   â”‚
â”‚ Query 2: Projetos em risco        â”‚
â”‚ SELECT * FROM vw_projects_at_risk â”‚
â”‚ WHERE supervisor_id = :user_id    â”‚
â”‚                                   â”‚
â”‚ Query 3: UsuÃ¡rios ativos          â”‚
â”‚ SELECT COUNT(DISTINCT user_id)    â”‚
â”‚ FROM task_assignments ta          â”‚
â”‚ JOIN tasks t ON ta.task_id = t.id â”‚
â”‚ WHERE t.status = 'em_desenvolvimento'â”‚
â”‚                                   â”‚
â”‚ Query 4: Tarefas em "refaca"      â”‚
â”‚ SELECT * FROM vw_tasks_with_projectâ”‚
â”‚ WHERE status = 'refaca'           â”‚
â”‚   AND supervisor_id = :user_id    â”‚
â”‚                                   â”‚
â”‚ Query 5: DistribuiÃ§Ã£o de status   â”‚
â”‚ SELECT status, COUNT(*)           â”‚
â”‚ FROM tasks t                      â”‚
â”‚ JOIN project_stages ps...         â”‚
â”‚ GROUP BY status                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 3. Aplicar cache (5 min)
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis Cache:                      â”‚
â”‚ Key: dashboard:supervisor:2       â”‚
â”‚ TTL: 300 segundos                 â”‚
â”‚ Value: { stats... }               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 4. Retornar JSON
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                 â”‚
â”‚   "open_projects": 5,             â”‚
â”‚   "at_risk_projects": 2,          â”‚
â”‚   "active_users": 12,             â”‚
â”‚   "refaca_tasks": 3,              â”‚
â”‚   "status_distribution": [        â”‚
â”‚     { "status": "novo", "count": 10 },â”‚
â”‚     { "status": "em_desenvolvimento",â”‚
â”‚       "count": 15 },              â”‚
â”‚     { "status": "concluido",      â”‚
â”‚       "count": 45 }               â”‚
â”‚   ],                              â”‚
â”‚   "recent_tasks": [...]           â”‚
â”‚ }                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 5. Renderizar componentes
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Dashboard                      â”‚
â”‚                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ 5       â”‚ 2       â”‚ 12      â”‚  â”‚
â”‚ â”‚Projetos â”‚Em Risco â”‚UsuÃ¡rios â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚
â”‚ ğŸ”´ 3 Tarefas em RefaÃ§a            â”‚
â”‚                                   â”‚
â”‚ Status das Tarefas:               â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ Novo (10)              â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ Em Desenv (15)     â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ Concl (45)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Fluxo de Monitoramento (Admin)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚
    â”‚ 1. Acessa /monitoring
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/monitoring/users  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 2. Query complexa
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT * FROM vw_user_statistics â”‚
â”‚ ORDER BY efficiency DESC         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 3. Calcular mÃ©tricas
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Para cada usuÃ¡rio:               â”‚
â”‚                                  â”‚
â”‚ efficiency = (estimated / logged)â”‚
â”‚            * 100                 â”‚
â”‚                                  â”‚
â”‚ refaca_rate = (refaca_tasks /    â”‚
â”‚                total_tasks) * 100â”‚
â”‚                                  â”‚
â”‚ completion_rate = (completed /   â”‚
â”‚                    total) * 100  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 4. Identificar problemas
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Alertas:                         â”‚
â”‚                                  â”‚
â”‚ âš ï¸ Pedro Oliveira                â”‚
â”‚    refaca_rate = 25% (>15%)      â”‚
â”‚    â†’ Alta taxa de retrabalho     â”‚
â”‚                                  â”‚
â”‚ âš ï¸ Ana Costa                     â”‚
â”‚    efficiency = 65% (<80%)       â”‚
â”‚    â†’ Levando mais tempo que      â”‚
â”‚       estimado                   â”‚
â”‚                                  â”‚
â”‚ âœ… Carlos Pereira                â”‚
â”‚    efficiency = 95%              â”‚
â”‚    refaca_rate = 5%              â”‚
â”‚    â†’ Desempenho excelente        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 5. Retornar relatÃ³rio
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tabela de Monitoramento:         â”‚
â”‚                                  â”‚
â”‚ UsuÃ¡rio    | Concl | RefaÃ§a | Effâ”‚
â”‚------------|-------|--------|----â”‚
â”‚ Pedro      |  15   |  25%   | 85%â”‚
â”‚ Ana        |  20   |  10%   | 65%â”‚
â”‚ Carlos     |  25   |   5%   | 95%â”‚
â”‚                                  â”‚
â”‚ ğŸ† Destaque: Carlos Pereira      â”‚
â”‚ âš ï¸ AtenÃ§Ã£o: Ana Costa            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Pontos CrÃ­ticos de ValidaÃ§Ã£o

### âœ… ValidaÃ§Ãµes ObrigatÃ³rias em Cada Fluxo

1. **AutenticaÃ§Ã£o**: Sempre validar JWT em rotas protegidas
2. **AutorizaÃ§Ã£o**: Verificar role do usuÃ¡rio antes de aÃ§Ã£o
3. **Limite 8h**: Validar em criaÃ§Ã£o/ediÃ§Ã£o de tarefa e atribuiÃ§Ã£o
4. **TransiÃ§Ã£o de Status**: Aplicar matriz de permissÃµes
5. **Integridade**: Usar transaÃ§Ãµes para operaÃ§Ãµes multi-step
6. **RecÃ¡lculo de Prazo**: Executar apÃ³s alteraÃ§Ãµes em tarefas/etapas

---

## 10. Resumo de Endpoints CrÃ­ticos

| Endpoint | ValidaÃ§Ãµes CrÃ­ticas |
|----------|---------------------|
| POST /api/projects | Role >= Supervisor |
| POST /api/stages | Role >= Supervisor, project ownership |
| POST /api/tasks | Role >= Supervisor, validar 8h/dia |
| PATCH /api/tasks/:id/status | Matriz de transiÃ§Ã£o + role |
| POST /api/tasks/:id/assignments | Validar 8h/dia para cada user |
| PUT /api/tasks/:id | Validar 8h/dia se alterar daily_hours |

---

**DocumentaÃ§Ã£o criada em**: 2026-01-02
**VersÃ£o**: 1.0
